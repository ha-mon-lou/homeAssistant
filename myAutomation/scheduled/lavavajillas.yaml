#
# https://homeassistant-notes.notion.site/Proyecto-studioBricks-1819be0e2c178025bfbce68fd774ab8d
#
- id: "scheduler_lavavajillas_on"
  alias: Scheduler lavavajillas on
  triggers:
    - trigger: state
      entity_id:
        - schedule.lavavajillas_schedule
      to: "on"
  conditions: []
  actions:
    - sequence:
        - action: switch.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: switch.zigbee_nous_enchufe_03 # lavavajillas
  mode: single

- id: "scheduler_lavavajillas_off"
  alias: Scheduler lavavajillas off
  trigger:
    - platform: state
      entity_id: schedule.lavavajillas_schedule
      to: "off"
  action:
    - wait_template: "{{ states('sensor.zigbee_nous_enchufe_03_power')|float < 5 }}"
      timeout: "00:10:00" # Espera mÃ¡ximo 10 minutos
      continue_on_timeout: false # No apaga si el consumo no baja
    - service: switch.turn_off
      target:
        entity_id: switch.zigbee_nous_enchufe_03
  mode: single
