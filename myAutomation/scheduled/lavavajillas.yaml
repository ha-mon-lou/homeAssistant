#
# https://homeassistant-notes.notion.site/Proyecto-studioBricks-1819be0e2c178025bfbce68fd774ab8d
#
- id: "scheduler_lavavajillas_on"
  alias: Scheduler lavavajillas on
  triggers:
    - trigger: state
      entity_id:
        - schedule.lavavajillas_schedule
      to: "on"
  conditions: []
  actions:
    - sequence:
        - action: switch.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: switch.zigbee_nous_enchufe_03 # lavavajillas
  mode: single

- id: "scheduler_lavavajillas_off"
  alias: Scheduler lavavajillas off
  trigger:
    - platform: state
      entity_id: schedule.lavavajillas_schedule
      to: "off"
  condition:
    # Verifica que el consumo ha estado bajo durante al menos 10 minutos
    - condition: numeric_state
      entity_id: sensor.zigbee_nous_enchufe_03_power
      below: 5 # Umbral de consumo en W
      for:
        minutes: 12 # Solo apagar√° si ha estado en pausa por 12 min
  action:
    - service: switch.turn_off
      target:
        entity_id: switch.zigbee_nous_enchufe_03
  mode: single
